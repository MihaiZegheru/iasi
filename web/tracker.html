<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IASI Problem Tracker</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 2em; }
        h1 { margin-bottom: 0.5em; }
        .progress { margin-bottom: 1em; }
        .problem-list { list-style: none; padding: 0; }
        .problem-item { margin-bottom: 0.5em; }
        .url-link { font-size: 0.9em; color: #555; margin-left: 1em; }
        .solved { text-decoration: line-through; color: #888; }
    </style>
</head>
<body>
    <h1>IASI Problem Tracker</h1>
    <div class="progress" id="progress"></div>
    <input type="text" id="search" placeholder="Search problems..." style="margin-bottom:1em;width:100%;padding:0.5em;">
    <ul class="problem-list" id="problemList"></ul>
    <script>
    // Load problems from the server
    let problems = [];
    let solved = {};
    let username = '';

    function updateProgress() {
        const total = problems.length;
        const done = problems.filter(p => solved[p.name]).length;
        document.getElementById('progress').textContent = `Solved: ${done} / ${total}`;
    }

    function renderList(filter = '') {
        const list = document.getElementById('problemList');
        list.innerHTML = '';
        problems.filter(p => p.name.toLowerCase().includes(filter.toLowerCase())).forEach(p => {
            const li = document.createElement('li');
            li.className = 'problem-item';
            const cb = document.createElement('input');
            cb.type = 'checkbox';
            cb.checked = !!solved[p.name];
            cb.onchange = () => {
                solved[p.name] = cb.checked;
                saveState();
                renderList(document.getElementById('search').value);
                updateProgress();
            };
            const label = document.createElement('span');
            label.textContent = p.name;
            if (cb.checked) label.className = 'solved';
            const link = document.createElement('a');
            link.href = p.url;
            link.textContent = 'link';
            link.target = '_blank';
            link.className = 'url-link';
            li.appendChild(cb);
            li.appendChild(label);
            li.appendChild(link);
            li.appendChild(document.createTextNode(' (' + p.time + ')'));
            list.appendChild(li);
        });
        updateProgress();
    }

    function saveState() {
        localStorage.setItem('iasi_tracker_' + username, JSON.stringify(solved));
    }
    function loadState() {
        const data = localStorage.getItem('iasi_tracker_' + username);
        if (data) solved = JSON.parse(data);
    }

    document.getElementById('search').oninput = (e) => {
        renderList(e.target.value);
    };

    // Fetch problems from server
    fetch('/problems')
        .then(r => r.json())
        .then(data => {
            problems = data.problems;
            username = data.username;
            loadState();
            renderList();
        });
    </script>
</body>
</html>
